#summary Einrichtung und Konfiguration der eXTra-Client Auslieferungsversion

*Inhaltsverzeichnis*
<wiki:toc max_depth="1" />

= Betriebsanleitung =

In der Betriebsanleitung wird beschrieben, wie der eXTra-Client zur Konfiguration und Betrieb von Fachverfahren verwendet werden kann. Die Auslieferungsversion des eXTra-Clients besteht aus einem zip-Archiv (z.B. extra-cli-1.0.0.zip). In diesem befindet sich der Basisteil. Die einzelnen Fachverfahren können getrennt vom Basisteil entwickelt werden und werden jeweils in gesonderten zip-Archiven ausgeliefert.

Der eXTra-Client unterstützt mehrere Kommunikationsabläufe, z.B.:
 * Senden von Eingabedateien an den eXTra-Server über einen Webservice
 * Ergebnisse vom eXTra-Server anfordern.
 * Bestätigungen an den eXTra-Server senden 

Die Kommunikationsabläufe werden von dem eXTra-Client in einer [eXTraClientBetriebDatenbank Datenbank] protokolliert (die Skripte zum Aufbau der Datenbank befinden sich in der Auslieferungsversion). Dies ist notwendig, da spätere Phasen eventuell Ergebnisse von Vorgängerphasen benötigen (z.B. Empfangsbestätigung von Dateien).

Der eXTra-Client kann so konfiguriert werden, das mehrstufige Fachverfahren (z.B. Sterbedatenabgleich) ohne Programmänderungen realisiert werden können. Falls noch Funktionalität fehlt, kann der eXTra-Client durch das Entwickeln neuer Plugins erweitert werden.

Auf der Seite [eXTraClientBetriebSzenarioSendFetch] wird exemplarisch die Installation des eXTra-Clients mit einem technischen Referenzverfahren beschrieben.

= Anforderungen an den Betriebsrechner =
Der eXTra-Client wird als Java Anwendung ausgeliefert und benötigt eine Java 6 Laufzeitumgebung. Er ist nicht an ein spezielles Betriebssystem gebunden. Für die Protokollierung des Kommuninkationsablaufes wird eine Datenbank benötigt (siehe [eXTraClientBetriebDatenbank Datenbank]). Für den Kommunikationsablauf müssen evtl. bestimmte Externe eXTra-Server erreichbar sein.

= Bestandteile der Basisversion (extraClient) =

Die Auslieferungsversion besteht aus dem Programm-Bereich, einem exemplarischen Ausführungs-Bereich und einem SQL-Skript-Bereich. Jeder Bereich befindet sich in einem Verzeichnis:

==== Ausführungsbereich (Verzeichnis: /bin) ==== 
Hier befinden sich beispielhaft Batch-Dateien für Windows (eXTra-cli.bat) und Linux. 

==== Programmbereich (Verzeichnis: /lib) ====
Hier stehen sämtliche benötigte Jar-Dateien - sowohl die eXTra-Jar-Dateien als auch die externen Bibliotheken zur Verfügung. Für eine Datenbindung Anbindung werden spezielle JDBC-Treiber benötigt (z.B. Oracle JDBC). Diese werden nicht mitgeliefert und müssen hier abgelegt werden.

==== SQL-Skript-Bereich (Verzeichnis: /sql) ==== 
Hier sind SQL-Skripte für den Aufbau der eXTra-Client Datenbank abgelegt. 

Aufgrund des modularen Aufbaus und der konfigurativen Steuerung des eXTra-Clients können zur Basisversion weitere Fachverfahren hinzugefügt werden. Pro Fachverfahren sollte die Konfiguration in einem Konfigurationsverzeichnisse abgelegt werden. Jedem Fachverfahren ist ein DB-Skript für die Initialisierung zugewiesen. 

= Installation/Bereitstellung einer Version =
Die Bereitstellung einer Version erfolgt in diesen Schritten:
 * Auspacken der Auslieferungsversion in einem Verzeichnis auf dem Betriebsrechner
 * DB-Treiber in den lib-Ordner Kopieren
 * Fachverfahren in einem eigenen Ordner ablegen. 
 * Konfigurationsdateien des Fachverfahrens an die Umgebung des Betriebsrechners anpassen (z.B. Verzeichnisse für Input und Output).
 * eXTra-Client Datenbank einrichten, initialisieren oder updaten (z.B. über mitgeliefertes SQL-Skript).
 * Batch-Dateien für den Aufruf der Fachverfahren im Ordner _bin_ erstellen bzw. anpassen

Genauere Informationen zur Einrichtung eines Fachverfahrens befinden sich in der Dokumentation des jeweiligen Fachverfahrens. Beispiel siehe [eXTraClientBetriebSzenarioSendFetch].

==Konfiguration==
Alle Konfigurationsdateien für einen Anwendungsfall befinden sich üblicherweise in einem Verzeichnis (z.B. conf). Dieses Verzeichnis wird beim Aufruf des eXTra-Clients als Parameter übergeben. 
Folgende Dateien bilden die Konfigurationsdaten für ein Fachverfahren:

|| *Datei* || *Beschreibung* ||
|| [eXTraClientBetriebConfigBasis extra-properties-basic.properties] || Zentrale Konfigurationsdatei. Besteht aus Attribut-Werte Paaren (Java-properties Format). In dieser Datei werden z.B. das Fachverfahren, die Plugins und die XML-Builder konfiguriert. ||
|| [eXTraClientBetriebConfigUser extra-properties-user.properties] || Ergänzende/überschreibende Einstellungen. Üblicherweise sind hier die Verbindungsparameter zur Datenbank und die Webservice-Zieladresse abgelegt. ||
|| [eXTraClientBetriebLogging logging-config.xml] || Logging Einstellungen (z.B. Name der Logfiles und Loglevel) ||
|| [eXTraClientBetriebConfigProfile ‚profile.xml’] || eXTra-Profil Datei (siehe eXTra Standard). In der Profil-Date sind die Elemente des Extra-Standards aufgeführt, die zur Kommunikation zwischen Client und Server verwendet werden sollen (Der Name ist frei wählbar.)||

==Aufruf der Fachverfahren==
Die Fachverfahren können über Batch-Dateien aufgerufen werden. Beispielhaft befindet sich im _/bin_ Verzeichnis der Auslieferungsversion ein Aufruf für Windows (extra.bat). In diesen Skripten wird eine Umgebungsvariable EXTRA_CLIENT_HOME für den Zugriff auf die eXTra-Client Dateien verwendet.

In der Datei extra.bat kann auch der Heap-Speicher angepasst werden. Dies kann nötig werden, wenn sehr große Dateien versendet werden sollen (> 30MB). Auf einem 32 Bit Windows System sind folgende Testdaten ermittelt worden: 

|| Heap Space || Dateigröße || Ergebnis ||
|| 1610 || 69,6 MB || Fehler ||
|| 1610 || 53,6 MB || OK ||

In einer Produktionsumgebung (64 Bit) kann der Heap-Speicher größer gewählt werden. In der aktuellen Version des eXTra-Clients muss aber im Vorfeld auf die Größe geachtet werden und der Heap-Space entsprechend groß gewählt werden.

*Beispiel für einen einfachen Aufruf:*

java -jar extra-cli-1.0.0-SNAPSHOT.jar -l logs -c conf

Das Logging erfolgt in das Verzeichnis logs. Die Konfiguration wird aus dem Verzeichnis conf gelesen.

===Aufrufparameter===

|| Parameter || Beispiel || Beschreibung ||
|| -c "Konfigurationsverzeichnis" || -c conf || Konfiguration wird aus dem Verzeichnis _conf_ gelesen *(Pflicht)* ||
|| -l "logs" || -l logs || Logs werden in das Verzeichnis _logs_ geschrieben ||
|| -h || -h || Hilfe ||

Im Verarbeitungsverlauf können vom eXTra-Client Ergebnisdateien abgelegt worden sein, die noch von einer externen Anwendung geprüft werden müssen. Das Ergebnis dieser Prüfung kann dem eXTra-Client über folgende zwei Parameter mitgeteilt werden:
	
|| Parameter || Beispiel || Beschreibung ||
|| -oc "Dateiname"|| -oc RESPONSE_10001_1355733323891 || Meldet das die Datei "Dateiname" erfolgreich verarbeitet werden konnte (oc steht für "Output Confirm") ||
|| -of "Dateiname"|| -of RESPONSE_10001_1355733323891 || Meldet das die Datei "Dateiname" nicht erfolgreich verarbeitet werden konnte (of steht für "Output Failure") ||

=== Beispiel einer Aufrufreihenfolge ===
Im Auslieferungsbestan folgenden wird 	

Die Aufrufe werden über den Parametrisierten Aufruf der Datei 'extra.bat' durchgeführt.

Aufruf Phase 1: Eine Datei an den eXTra-Server senden
Aufruf Phase 2: 3 Dateien vom Server empfangen.

extra.bat conf\luxemburg\phase2 -oc "FIKELA.PRD.DS.LU2013-08-28 10-01-34.676"


Aufruf Phase 3: Eine Datei an den eXTra-Server senden

Aufruf Phase 3: Keine Bestätigung

	