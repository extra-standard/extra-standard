#summary Durchführung eines Fachverfahrens (Live Demo)

= Demonstration Sterbedatenabgleich (Testumgebung) =

Im folgenden wird gezeigt, wie das Fachverfahren _Sterbedatenabgleich_ in einer Testumgebung (eXTra-Server wird mit soapUI simuliert) durchgeführt werden kann.

== Kurze Beschreibung des Fachverfahrens ==

Das Fachverfahren ist in drei Phasen aufgeteilt:

 * In *Phase 1* werden alle Dateien die sich im Eingabe-Verzeichnis befinden, jeweils einzeln in einer eXTra-Nachricht verpackt und an den eXTra-Server versendet.
 * In *Phase 2* fragt der eXTra-Client den eXTra-Server ob neue Ergebnisdateien vorliegen. Der eXTra-Server übermittelt dem eXTra-Client 0 bis n Ergebnisdateien (mit Erfolgsstatus). Die Ergebnisdateien werden im Ausgabe-Verzeichnis abgelegt.
 * In *Phase 3* bestätigt der eXTra-Client dem eXTra-Server den Empfang der erfolgreich verarbeiteten Dateien. Der Empfang einer fehlerhaft verarbeiteten Datei wird nicht bestätigt

== Fachverfahren einrichten ==

Das Fachverfahren wird wie in der Betriebsanleitung beschrieben konfiguriert und eingerichtet. Folgende Verzeichnisstruktur ergibt sich:

{{{
D:\eXTra
- extra-client
  - bin
  - lib
  - sql
- fachverfahren
  - extra-sterbedaten-ausland
    - bin
    - conf
      - italien
        - phase1
        - phase2
        - phase3
      + luxemburg
    - docs
    - logs
    - soapui
    - sql
    - work
      - italien
        - input
        - reports
        - responses
      + luxemburg
}}}

Die [Datenbank eXTraClientBetriebDatenbank] (Oracle XE) ist mit dem Werkzeug _flyway_ aufgebaut worden.

== Server simulieren (soapUI Projekt starten) ==

Im Auslieferungsarchiv des Fachverfahrens befindet sich auch ein soapUI-Projekt mit dem der eXTra-Server simuliert wird. Für die möglichen Server-Responses sind Mock-Services eingerichtet: 

http://extra-standard.googlecode.com/svn/wiki/images/extra-demo-sterbedaten-soapui.png

Für jeden Service wird eine Adresse angegeben:

http://extra-standard.googlecode.com/svn/wiki/images/extra-demo-sterbedaten-soapui-service.png

Diese Adresse ist in der Konfigurationsdatei _extra-properties-user.properties_ eingetragen:

{{{
webservice.endpoint.url=http://localhost:8088/mockExtraSterbedatenausPhase1
}}}

In soapUI werden die benötigten Services gestartet (ExtraMockServiceSterbedatenausPhase1-3, jeweils Klick auf grünes Dreieck)
== Phase 1 durchführen ==

In Phase 1 sendet der eXTra-Client alle Dateien aus dem Verzeichnis _work/input_ an den Server. Jede Datei wird in einer eigenen eXTra-Nachricht versendet.

*Aufruf:* bin/italienPhase1.bat

Jeder eXTra-Client Nachricht ist in der [eXTraClientBetriebDatenbank eXTra-Client Datenbank] ein Eintrag in der Tabelle _EXECUTION_ zugeordnet. Folgendes SQL liefert eine Übersicht über den Kommunikationsablauf:

{{{
select EX.ID AS "Ex.Id", INP.ID AS "In.ID", EX.PHASE, INP.INPUT_IDENTIFIER, INP.REQUEST_ID, INP.RESPONSE_ID, ST.NAME AS "Status", INP.RETURN_TEXT from EXECUTION ex, COMMUNICATION_PROTOCOL inp, STATUS st where EX.ID = INP.EXECUTION_ID and INP.STATUS_ID = st.ID order by EX.ID, INP.ID;
}}}
 
=== Datenbank ===

== Phase 2 durchführen ==

== Phase 3 durchführen ==

== Fehlerbehandlung ==